<!-- v6.1 stable – reports, export, UI locked -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MONTBLOCK – Factory System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#000;color:#fff;padding:15px;text-align:center}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:#ddd;padding:10px}
nav button{padding:10px;margin:5px;border:none;background:#000;color:#fff;border-radius:4px}
section{display:none;padding:15px}
.card{background:#fff;padding:15px;border-radius:6px;margin-bottom:15px}
input,select,button{width:100%;padding:8px;margin:6px 0}
hr{margin:15px 0}
.item{border-bottom:1px solid #ddd;padding:8px 0}
.small{font-size:13px;color:#555}
.sellBtn{background:#0a7d0a;color:#fff}
.expBtn{background:#b00020;color:#fff}
.exportBtn{background:#004aad;color:#fff}
@media print{
 nav,button{display:none}
 body{background:#fff}
}
</style>
</head>

<body>

<header>MONTBLOCK – Factory System</header>

<nav>
<button onclick="show('dash')">Dashboard</button>
<button onclick="show('cement')">Cement</button>
<button onclick="show('prod')">Production</button>
<button onclick="show('sale')">Sales</button>
<button onclick="show('exp')">Expenses</button>
<button onclick="show('history')">History</button>
<button onclick="show('report')">Reports</button>
</nav>

<section id="dash" class="card"></section>

<section id="cement" class="card">
<h3>Cement IN</h3>
<input id="cin_bags" type="number" placeholder="Bags">
<input id="cin_price" type="number" placeholder="Price per bag">
<button onclick="saveCementIn()">Save Cement IN</button>
<hr>
<h3>Cement OUT</h3>
<input id="cout_bags" type="number" placeholder="Bags used">
<button onclick="saveCementOut()">Save Cement OUT</button>
</section>

<section id="prod" class="card">
<h3>Production</h3>
<select id="psize">
<option value="4">4"</option>
<option value="5">5"</option>
<option value="6">6"</option>
</select>
<input id="pqty" type="number" placeholder="Quantity">
<button onclick="saveProduction()">Save Production</button>
</section>

<section id="sale" class="card">
<h3>Sales</h3>
<select id="ssize">
<option value="4">4"</option>
<option value="5">5"</option>
<option value="6">6"</option>
</select>
<input id="sqty" type="number" placeholder="Quantity">
<input id="sprice" type="number" placeholder="Price per block">
<button class="sellBtn" onclick="saveSale()">Save Sale</button>
</section>

<section id="exp" class="card">
<h3>Expense</h3>
<input id="ename" placeholder="Expense name">
<input id="eamt" type="number" placeholder="Amount">
<button class="expBtn" onclick="saveExpense()">Save Expense</button>
</section>

<section id="history" class="card">
<h3>History (Latest First)</h3>
<div id="hlist"></div>
</section>

<section id="report" class="card">
<h3>Reports</h3>
<label>From</label>
<input type="date" id="rFrom">
<label>To</label>
<input type="date" id="rTo">
<button onclick="generateReport()">Generate Report</button>
<hr>
<div id="reportSummary"></div>
<hr>
<div id="reportDetails"></div>
<button class="exportBtn" onclick="window.print()">Print / Save PDF</button>
<button class="exportBtn" onclick="shareReport()">Share Report</button>
</section>

<script>
let store=JSON.parse(localStorage.getItem("montblock_v7"))||{
 cement:0,
 blocks:{4:0,5:0,6:0},
 cementIn:[],cementOut:[],
 production:[],sales:[],expenses:[]
};

function save(){localStorage.setItem("montblock_v7",JSON.stringify(store));renderDash();}

function today(){return new Date().toDateString()}
function now(){return new Date().toLocaleTimeString()}

function show(id){
["dash","cement","prod","sale","exp","history","report"].forEach(s=>document.getElementById(s).style.display="none");
document.getElementById(id).style.display="block";
if(id==="history")renderHistory();
if(id==="report")renderDash();
}

function renderDash(){
document.getElementById("dash").innerHTML=`
<h3>Dashboard</h3>
<b>Cement Stock:</b> ${store.cement} bags<hr>
4" Blocks: ${store.blocks[4]}<br>
5" Blocks: ${store.blocks[5]}<br>
6" Blocks: ${store.blocks[6]}
`;
}

function saveCementIn(){
let b=+cin_bags.value,p=+cin_price.value;
store.cement+=b;
store.cementIn.push({bags:b,price:p,date:today(),time:now()});
cin_bags.value=cin_price.value="";
save();
}

function saveCementOut(){
let b=+cout_bags.value;
store.cement-=b;
store.cementOut.push({bags:b,date:today(),time:now()});
cout_bags.value="";
save();
}

function saveProduction(){
let s=psize.value,q=+pqty.value;
store.blocks[s]+=q;
store.production.push({size:s,qty:q,date:today()});
pqty.value="";
save();
}

function saveSale(){
let s=ssize.value,q=+sqty.value,p=+sprice.value;
store.blocks[s]-=q;
store.sales.push({size:s,qty:q,total:q*p,date:today()});
sqty.value=sprice.value="";
save();
}

function saveExpense(){
let n=ename.value,a=+eamt.value;
store.expenses.push({name:n,amt:a,date:today()});
ename.value=eamt.value="";
save();
}

function renderHistory(){
let h=document.getElementById("hlist");
h.innerHTML="";
[...store.expenses.map(r=>({t:"Expense",d:`${r.name} – ${r.amt}`,date:r.date})),
 ...store.production.map(r=>({t:"Production",d:`${r.size}" Qty ${r.qty}`,date:r.date})),
 ...store.cementIn.map(r=>({t:"Cement IN",d:`Bags ${r.bags} @ ${r.price}`,date:r.date})),
 ...store.sales.map(r=>({t:"Sale",d:`${r.size}" Qty ${r.qty} – ${r.total}`,date:r.date}))
].reverse().forEach(r=>{
h.innerHTML+=`<div class="item"><b>${r.t}</b><br>${r.d}<br><span class="small">${r.date}</span></div>`;
});
}

function generateReport(){
let sales=store.sales,exp=store.expenses,prod=store.production,cin=store.cementIn;
let totalSales=0,totalExp=0,cementCost=0;
let blocks={4:0,5:0,6:0},sold={4:0,5:0,6:0},salesVal={4:0,5:0,6:0};

cin.forEach(r=>cementCost+=r.bags*r.price);
exp.forEach(r=>totalExp+=r.amt);
prod.forEach(r=>blocks[r.size]+=r.qty);
sales.forEach(r=>{
 sold[r.size]+=r.qty;
 salesVal[r.size]+=r.total;
 totalSales+=r.total;
});

let totalCost=cementCost+totalExp;
let totalBlocks=blocks[4]+blocks[5]+blocks[6];
let costPerBlock=totalBlocks?totalCost/totalBlocks:0;

let p4=sold[4]?salesVal[4]/sold[4]-costPerBlock:0;
let p5=sold[5]?salesVal[5]/sold[5]-costPerBlock:0;
let p6=sold[6]?salesVal[6]/sold[6]-costPerBlock:0;

reportSummary.innerHTML=`
<b>Summary</b><br>
Sales: ${totalSales}<br>
Expenses: ${totalExp}<br>
Profit: ${totalSales-totalCost}<br><br>
<b>Profit per block</b><br>
4": ${p4.toFixed(0)}<br>
5": ${p5.toFixed(0)}<br>
6": ${p6.toFixed(0)}
`;
}

function shareReport(){
navigator.share({text:document.getElementById("reportSummary").innerText});
}

renderDash();
show('dash');
</script>

</body>
</html>