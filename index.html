<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MONTBLOCK – Factory System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#000;color:#fff;padding:15px;text-align:center;font-weight:bold}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:#ddd}
nav button{padding:12px;margin:6px;border:none;background:#000;color:#fff;border-radius:6px}
section{display:none;padding:15px}
.card{background:#fff;padding:15px;border-radius:6px;margin-bottom:15px}
input,select,button{width:100%;padding:10px;margin:6px 0}
hr{margin:15px 0}
.item{border-bottom:1px solid #ddd;padding:8px 0}
.small{font-size:13px;color:#555}
.sellBtn{background:#0a7d0a;color:#fff}
.expBtn{background:#b00020;color:#fff}
.exportBtn{background:#004aad;color:#fff}

/* ✅ FIX: make date inputs visible on mobile */
input[type="date"]{
  background:#fff !important;
  color:#000 !important;
  opacity:1 !important;
  border:1px solid #ccc;
}

@media print{
  nav,button{display:none}
  body{background:#fff}
}
</style>
</head>

<body>
<header>MONTBLOCK – Factory System</header>

<nav>
<button onclick="show('dash')">Dashboard</button>
<button onclick="show('cement')">Cement</button>
<button onclick="show('prod')">Production</button>
<button onclick="show('sale')">Sales</button>
<button onclick="show('exp')">Expenses</button>
<button onclick="show('history')">History</button>
<button onclick="show('report')">Reports</button>
</nav>

<section id="dash" class="card"></section>

<section id="cement" class="card">
<h3>Cement IN</h3>
<input type="date" id="cin_date">
<input id="cin_bags" type="number" placeholder="Bags purchased">
<input id="cin_price" type="number" placeholder="Price per bag">
<button onclick="cementIn()">Save Cement IN</button>

<hr>

<h3>Cement OUT</h3>
<input type="date" id="cout_date">
<input id="cout_bags" type="number" placeholder="Bags used">
<button onclick="cementOut()">Save Cement OUT</button>
</section>

<section id="prod" class="card">
<h3>Production</h3>
<input type="date" id="pdate">
<select id="psize">
<option value="4">4 inch</option>
<option value="5">5 inch</option>
<option value="6">6 inch</option>
</select>
<input id="pqty" type="number" placeholder="Quantity">
<button onclick="saveProd()">Save Production</button>
</section>

<section id="sale" class="card">
<h3>Sales</h3>
<input type="date" id="sdate">
<select id="ssize">
<option value="4">4 inch</option>
<option value="5">5 inch</option>
<option value="6">6 inch</option>
</select>
<input id="sqty" type="number" placeholder="Quantity sold">
<input id="sprice" type="number" placeholder="Price per block">
<button class="sellBtn" onclick="saveSale()">Save Sale</button>
</section>

<section id="exp" class="card">
<h3>Expense</h3>
<input type="date" id="edate">
<input id="ename" placeholder="Expense name">
<input id="eamt" type="number" placeholder="Amount">
<button class="expBtn" onclick="saveExpense()">Save Expense</button>
</section>

<section id="history" class="card">
<h3>History (Latest First)</h3>
<div id="hlist"></div>
</section>

<section id="report" class="card">
<h3>Reports</h3>
<input type="date" id="rfrom">
<input type="date" id="rto">
<button onclick="renderReport()">Generate Report</button>
<hr>
<div id="rout"></div>
<button class="exportBtn" onclick="window.print()">Print / Save PDF</button>
</section>

<script>
let store=JSON.parse(localStorage.getItem("montblock_v61"))||{
cement:0,blocks:{4:0,5:0,6:0},sales:0,expenses:0,records:[]
};

function save(){localStorage.setItem("montblock_v61",JSON.stringify(store));renderDash();}
function show(id){document.querySelectorAll("section").forEach(s=>s.style.display="none");document.getElementById(id).style.display="block";if(id==="history")renderHistory();if(id==="report")renderReport();}
function today(d){return d||new Date().toDateString();}

function cementIn(){
store.cement+=+cin_bags.value;
store.records.push({t:"Cement IN",d:today(cin_date.value),txt:`Bags ${cin_bags.value} @ ${cin_price.value}`});
save();
}

function cementOut(){
store.cement-=+cout_bags.value;
store.records.push({t:"Cement OUT",d:today(cout_date.value),txt:`Bags used ${cout_bags.value}`});
save();
}

function saveProd(){
store.blocks[psize.value]+=+pqty.value;
store.records.push({t:"Production",d:today(pdate.value),txt:`${psize.value}" Qty ${pqty.value}`});
save();
}

function saveSale(){
store.blocks[ssize.value]-=+sqty.value;
let amt=sqty.value*sprice.value;
store.sales+=amt;
store.records.push({t:"Sale",d:today(sdate.value),txt:`${ssize.value}" Qty ${sqty.value} = ${amt}`});
save();
}

function saveExpense(){
store.expenses+=+eamt.value;
store.records.push({t:"Expense",d:today(edate.value),txt:`${ename.value} – ${eamt.value}`});
save();
}

function renderDash(){
dash.innerHTML=`
<h3>Dashboard</h3>
<b>Cement Stock:</b> ${store.cement} bags<hr>
4" Blocks: ${store.blocks[4]}<br>
5" Blocks: ${store.blocks[5]}<br>
6" Blocks: ${store.blocks[6]}<hr>
<b>Total Sales:</b> ${store.sales}<br>
<b>Total Expenses:</b> ${store.expenses}<br>
<b>Profit:</b> ${store.sales-store.expenses}
`;
}

function renderHistory(){
hlist.innerHTML="";
store.records.slice().reverse().forEach(r=>{
hlist.innerHTML+=`<div class="item"><b>${r.t}</b><br>${r.txt}<br><span class="small">${r.d}</span></div>`;
});
}

function renderReport(){
rout.innerHTML=`
<b>Sales:</b> ${store.sales}<br>
<b>Expenses:</b> ${store.expenses}<br>
<b>Profit:</b> ${store.sales-store.expenses}
`;
}

renderDash();
show('dash');
</script>
</body>
</html>