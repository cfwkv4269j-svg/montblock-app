<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MONTBLOCK ‚Äì Factory System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#000;color:#fff;padding:15px;text-align:center;font-weight:bold}
nav{display:flex;flex-wrap:wrap;justify-content:space-around;background:#e0e0e0;padding:10px}
nav button{padding:10px;border:none;background:#000;color:#fff;border-radius:4px;margin:3px}
section{padding:15px}
.card{background:#fff;padding:12px;margin-bottom:12px;border-radius:6px}
hr{border:none;border-top:1px solid #ccc;margin:15px 0}
.small{font-size:13px;color:#555}
.report-btns button{margin:4px}
@media print{
  nav,button{display:none}
  body{background:#fff}
}
</style>
</head>

<body>

<header>MONTBLOCK ‚Äì Factory System</header>

<nav>
<button onclick="show('dash')">Dashboard</button>
<button onclick="show('report')">Reports</button>
</nav>

<section id="dash" class="card"></section>

<section id="report" class="card" style="display:none">
<div class="report-btns">
<button onclick="renderDaily()">Daily Report</button>
<button onclick="renderWeekly()">Weekly Report</button>
<button onclick="renderMonthly()">Monthly Report</button>
<button onclick="window.print()">Print / Save as PDF</button>
</div>
<hr>
<div id="reportContent"></div>
</section>

<script>
let store = JSON.parse(localStorage.getItem("montblock_v31")) || {records:[]};

function show(id){
["dash","report"].forEach(s=>document.getElementById(s).style.display="none");
document.getElementById(id).style.display="block";
if(id==="dash")dashboard();
}

function dashboard(){
let cement=0,sales=0,exp=0,stock={4:0,5:0,6:0};
store.records.forEach(r=>{
 if(r.type==="cement_in"){cement+=r.bags;exp+=r.bags*r.price;}
 if(r.type==="cement_out")cement-=r.bags;
 if(r.type==="prod")stock[r.size]+=r.qty;
 if(r.type==="sale"){stock[r.size]-=r.qty;sales+=r.qty*r.price;}
 if(r.type==="exp")exp+=r.amt;
});
dash.innerHTML=`
<h3>üß± BLOCK STOCK</h3>
<p>4" Blocks: <b>${stock[4]}</b></p>
<p>5" Blocks: <b>${stock[5]}</b></p>
<p>6" Blocks: <b>${stock[6]}</b></p>
<hr>
<h3>üèóÔ∏è CEMENT</h3>
<p>Cement Stock: <b>${cement} bags</b></p>
<hr>
<h3>üí∞ SUMMARY</h3>
<p>Sales: <b>${sales.toLocaleString()}</b></p>
<p>Expenses: <b>${exp.toLocaleString()}</b></p>
<p><b>Profit: ${(sales-exp).toLocaleString()}</b></p>`;
}

function renderDaily(){
let today=new Date().toISOString().slice(0,10);
renderReport(r=>r.date.split("-").reverse().join("-")===today,"DAILY REPORT");
}

function renderWeekly(){
let now=new Date();
let start=new Date(now);start.setDate(now.getDate()-now.getDay());
renderReport(r=>new Date(r.date.split("-").reverse().join("-"))>=start,"WEEKLY REPORT",true);
}

function renderMonthly(){
let m=new Date().toISOString().slice(0,7);
renderReport(r=>r.date.split("-").reverse().join("-").startsWith(m),"MONTHLY REPORT",true);
}

function renderReport(filter,title,profitBySize=false){
let sales=0,exp=0;
let sizeSales={4:0,5:0,6:0};
store.records.filter(filter).forEach(r=>{
 if(r.type==="sale"){
   let amt=r.qty*r.price;
   sales+=amt;
   sizeSales[r.size]+=amt;
 }
 if(r.type==="cement_in")exp+=r.bags*r.price;
 if(r.type==="exp")exp+=r.amt;
});
let profit=sales-exp;
let html=`<h3>${title}</h3>
<p>Sales: ${sales.toLocaleString()}</p>
<p>Expenses: ${exp.toLocaleString()}</p>
<p><b>Profit: ${profit.toLocaleString()}</b></p>`;
if(profitBySize && sales>0){
 html+=`<hr><h4>Profit per Block Size</h4>`;
 [4,5,6].forEach(s=>{
   let p=Math.round((sizeSales[s]/sales)*profit)||0;
   html+=`<p>${s}" Blocks: ${p.toLocaleString()}</p>`;
 });
}
reportContent.innerHTML=html;
}

dashboard();
</script>

</body>
</html>