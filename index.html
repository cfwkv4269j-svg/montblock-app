<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MONTBLOCK – Factory System</title>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#000;color:#fff;padding:15px;text-align:center;font-weight:bold}
nav{display:flex;flex-wrap:wrap;justify-content:space-around;background:#ddd;padding:10px}
nav button{padding:10px;border:none;background:#000;color:#fff;border-radius:4px;margin:3px}
section{display:none;padding:15px}
.card{background:#fff;padding:15px;border-radius:6px}
input,select{width:100%;padding:8px;margin:6px 0}
hr{margin:15px 0}
.sellBtn{background:#0a7d0a}
.expBtn{background:#b00020}
.editBtn{background:#444;color:#fff;padding:4px 8px;border:none;border-radius:4px;margin-right:5px}
.delBtn{background:#900;color:#fff;padding:4px 8px;border:none;border-radius:4px}
.item{border-bottom:1px solid #ddd;padding:10px 0}
.title{font-weight:bold}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header>MONTBLOCK – Factory System</header>

<nav>
<button onclick="show('dash')">Dashboard</button>
<button onclick="show('cement')">Cement</button>
<button onclick="show('prod')">Production</button>
<button onclick="show('sales')">Sales</button>
<button onclick="show('exp')">Expenses</button>
<button onclick="show('history')">History</button>
</nav>

<section id="dash" class="card">
<h3>Dashboard</h3>
<p><b>Cement Stock:</b> <span id="cementStock">0</span> bags</p>
<hr>
<p><b>4″ Blocks:</b> <span id="b4">0</span></p>
<p><b>5″ Blocks:</b> <span id="b5">0</span></p>
<p><b>6″ Blocks:</b> <span id="b6">0</span></p>
<hr>
<p><b>Total Sales:</b> TZS <span id="totalSales">0</span></p>
<p><b>Total Expenses:</b> TZS <span id="totalExpenses">0</span></p>
<hr>
<p><b>PROFIT:</b> TZS <span id="profit">0</span></p>
</section>

<section id="cement" class="card">
<h3>Cement IN</h3>
<input type="number" id="inBags" placeholder="Bags purchased">
<input type="number" id="inPrice" placeholder="Price per bag">
<button onclick="cementIn()">Save Cement IN</button>
<hr>
<h3>Cement OUT</h3>
<input type="number" id="outBags" placeholder="Bags used">
<button onclick="cementOut()">Save Cement OUT</button>
</section>

<section id="prod" class="card">
<h3>Block Production</h3>
<select id="pSize">
<option value="4">4 inch blocks</option>
<option value="5">5 inch blocks</option>
<option value="6">6 inch blocks</option>
</select>
<input type="number" id="pQty" placeholder="Quantity produced">
<button onclick="saveProduction()">Save Production</button>
</section>

<section id="sales" class="card">
<h3>SELL BLOCKS</h3>
<select id="sSize">
<option value="4">4 inch blocks</option>
<option value="5">5 inch blocks</option>
<option value="6">6 inch blocks</option>
</select>
<input type="number" id="sQty" placeholder="Quantity sold">
<input type="number" id="sPrice" placeholder="Price per block">
<button class="sellBtn" onclick="sellBlocks()">SELL BLOCKS</button>
</section>

<section id="exp" class="card">
<h3>Expenses</h3>
<input id="expName" placeholder="Expense name">
<input type="number" id="expAmount" placeholder="Amount">
<button class="expBtn" onclick="saveExpense()">Save Expense</button>
</section>

<section id="history" class="card">
<h3>History (Latest First)</h3>
<div id="historyList"></div>
</section>

<script>
let store = JSON.parse(localStorage.getItem("montblock_factory_v54")) || {
 cementIn:[], cementOut:[], production:[], sales:[], expenses:[]
};
let editRef=null;

function today(){return new Date().toDateString();}

function show(id){
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
 if(id==="history") renderHistory();
}

function save(){
 localStorage.setItem("montblock_factory_v54",JSON.stringify(store));
 updateDashboard();
}

function cementIn(){
 let r={type:"Cement IN",bags:+inBags.value,price:+inPrice.value,date:today()};
 if(editRef){store.cementIn[editRef.i]=r;editRef=null;} else store.cementIn.push(r);
 inBags.value="";inPrice.value="";save();
}
function cementOut(){
 let r={type:"Cement OUT",bags:+outBags.value,date:today()};
 if(editRef){store.cementOut[editRef.i]=r;editRef=null;} else store.cementOut.push(r);
 outBags.value="";save();
}
function saveProduction(){
 let r={type:"Production",size:pSize.value,qty:+pQty.value,date:today()};
 if(editRef){store.production[editRef.i]=r;editRef=null;} else store.production.push(r);
 pQty.value="";save();
}
function sellBlocks(){
 let r={type:"Sale",size:sSize.value,qty:+sQty.value,price:+sPrice.value,total:sQty.value*sPrice.value,date:today()};
 if(editRef){store.sales[editRef.i]=r;editRef=null;} else store.sales.push(r);
 sQty.value="";sPrice.value="";save();
}
function saveExpense(){
 let r={type:"Expense",name:expName.value,amt:+expAmount.value,date:today()};
 if(editRef){store.expenses[editRef.i]=r;editRef=null;} else store.expenses.push(r);
 expName.value="";expAmount.value="";save();
}

function updateDashboard(){
 let cin=0,cout=0;
 store.cementIn.forEach(c=>cin+=c.bags);
 store.cementOut.forEach(c=>cout+=c.bags);
 cementStock.innerText=cin-cout;

 let b4=0,b5=0,b6=0;
 store.production.forEach(p=>{if(p.size=="4")b4+=p.qty;if(p.size=="5")b5+=p.qty;if(p.size=="6")b6+=p.qty;});
 store.sales.forEach(s=>{if(s.size=="4")b4-=s.qty;if(s.size=="5")b5-=s.qty;if(s.size=="6")b6-=s.qty;});
 b4.innerText=b4;b5.innerText=b5;b6.innerText=b6;

 let ts=0;store.sales.forEach(s=>ts+=s.total);
 let te=0;store.expenses.forEach(e=>te+=e.amt);
 totalSales.innerText=ts.toLocaleString();
 totalExpenses.innerText=te.toLocaleString();
 profit.innerText=(ts-te).toLocaleString();
}

function renderHistory(){
 historyList.innerHTML="";
 let all=[];
 store.cementIn.forEach((r,i)=>all.push({r,i,t:"cementIn"}));
 store.cementOut.forEach((r,i)=>all.push({r,i,t:"cementOut"}));
 store.production.forEach((r,i)=>all.push({r,i,t:"production"}));
 store.sales.forEach((r,i)=>all.push({r,i,t:"sales"}));
 store.expenses.forEach((r,i)=>all.push({r,i,t:"expenses"}));
 all.reverse().forEach(o=>{
  let r=o.r;
  let can=r.date===today();
  let desc=r.type==="Sale"?`${r.size}″ Qty ${r.qty} – TZS ${r.total.toLocaleString()}`:
           r.type==="Production"?`${r.size}″ Qty ${r.qty}`:
           r.type==="Expense"?`${r.name} – TZS ${r.amt.toLocaleString()}`:
           r.type==="Cement IN"?`Bags ${r.bags} @ ${r.price}`:
           `Bags used ${r.bags}`;
  historyList.innerHTML+=`
  <div class="item">
   <div class="title">${r.type}</div>
   <div class="small">${desc}</div>
   <div class="small">Date: ${r.date}</div>
   ${can?`<button class="editBtn" onclick="edit('${o.t}',${o.i})">Edit</button>
   <button class="delBtn" onclick="del('${o.t}',${o.i})">Delete</button>`:""}
  </div>`;
 });
}

function edit(t,i){
 editRef={t,i};
 let r=store[t][i];
 show(t==="expenses"?"exp":t==="production"?"prod":t==="sales"?"sales":"cement");
 if(t==="cementIn"){inBags.value=r.bags;inPrice.value=r.price;}
 if(t==="cementOut"){outBags.value=r.bags;}
 if(t==="production"){pSize.value=r.size;pQty.value=r.qty;}
 if(t==="sales"){sSize.value=r.size;sQty.value=r.qty;sPrice.value=r.price;}
 if(t==="expenses"){expName.value=r.name;expAmount.value=r.amt;}
}

function del(t,i){
 if(confirm("Delete this record?")){
  store[t].splice(i,1);save();renderHistory();
 }
}

updateDashboard();show("dash");
</script>

</body>
</html>